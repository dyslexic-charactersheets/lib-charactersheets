# Copyright 2025 Marcus Downing
# This file is licensed under the ORC License.
# See the ORC Notice within this repository.

unit: defs/archetypes
group: "_{Player Core}"
name: "_{Archetypes}"

inc:

  - copy: archetype-resiliency
    params:
      class-id:
      class-feats:
      hp: 8
    contents:
      - selectable: "##:resiliency"
        contents:
          - p:
            title: "_{Prerequisite}"
            content: "_{A class granting no more than #{hp}hp}"
          - g:
            pad: true
            contents:
              - calc:
                output:
                  field: "#{class-id}/resiliency/bonus-hp"
                  legend: "_{Bonus Hit Points}"
                  width: huge
                  suffix: "_{hp}"
                  eq: "3*%{#{class-id}-feats}"
                inputs:
                  - span: "3 &times;"
                  - field: "#{class-id}-feats"
                    label: "#{class-feats}"
                    control: checkgrid
                    style: progress
                    max: 10
                    depth: 2
                    width: stretch

  - copy: archetype-feats
    params:
      id: class-feats
      show-basic: true
      show-advanced: true
      basic-level: 4
      basic-title: "_{Basic Feats}"
      advanced-level: 6
      advanced-title: "_{Advanced Feats}"
      class-level: "_{Class\nLevel}"
      num: 6
      lines: 3
    contents:
      - list:
        hr: true
        zebra: true
        contents:
          - if: "#{show-basic}"
            then:
              - level: "#{basic-level}"
                contents:
                  - h5: "#{basic-title}"
                  - p: "_{1st or 2nd level feat}"
              - selectable: "#{id}:basic-feats"
                flex: small
                contents:
                  - article: "#{id}/#{i}"
                    lines: "#{lines}"
                    reduce: 1
          - if: "#{show-advanced}"
            then:
              - level: "#{advanced-level}"
                contents:
                  - h5: "#{advanced-title}"
                  - calc:
                    inline: true
                    output:
                      label: "#{class-level}"
                      eq: "floor(%{level}/2)"
                    inputs:
                      - label: "_{Character\nLevel}"
                      - span: "&divide; 2"
              - repeat: "#{num}"
                reduce: 1
                flex: large
                contents:
                  - selectable: "#{id}:advanced-feat/#{i}"
                    contents:
                      - article:
                        lines: "#{lines}"
                        reduce: 1


  - copy: archetype-spellcasting-rank
    params:
      rank: 0
      num: 2
      max: 2
      style: spontaneous
    contents:
      - level: "#{rank}"
        marker: ''
        contents:
          - if: "#{style}==prepared"
            then:
              - repeat: "#{num}"
                merge-bottom: true
                contents:
                  - field: "archetype-spells-#{rank}"
                    width: stretch
                    frame: none
                    control: compound
                    parts:
                      - control: checkbox
                      - width: stretch
            else:
              - if: "#{style}==spontaneous"
                then:
                  - layout: indent-r
                    contents:
                      - g:
                        contents:
                          - field: "archetype-spells-#{rank}"
                            width: stretch
                            repeat: "#{num}"
                            frame: none
                            merge-bottom: true
                      - g:
                        contents:
                          - field: "archetype-spells-#{rank}-today"
                            control: checkgrid
                            max: "#{max}"
                            depth: 1
                            frame: none
                else:
                  - g:
                    contents:
                      - field: "archetype-spells-#{rank}"
                        width: stretch
                        repeat: "#{num}"
                        frame: none
                        merge-bottom: true

  - copy: archetype-spellcasting
    params:
      id: ""
      style: spontaneous
      cantrips: 2
      ability: ""
      ability-name: ""
      breadth: ""
      spell-dcs-zone-id: ""
    contents:
      - section: "_{Spellcasting}"
        contents:
          - list:
            hr: true
            contents:
              - item:
              - g:
                contents:
                  - zone: '#{spell-dcs-zone-id}'
                    contents:
                      - calc:
                        output:
                          field: "spell-attack"
                          legend: "_{Spell attack}"
                          icon: bonus
                          eq: "%{#{ability}}+%{spell-proficiency-bonus}+%{spell-attack-misc}"
                        inputs:
                          - field:
                            ref: "#{ability}"
                            label: "#{ability-name}"
                            underlay: "#{ability-name}"
                          - span: "+"
                          - field: "spell-proficiency"
                            label: "_{Proficiency}"
                            control: proficiency
                            value: trained
                          # - field: "spell-attack-misc"
                          #   label: "_{Misc}"
                          #   misc: true
                      - calc:
                        output:
                          field: "spell-dc"
                          legend: "_{Spell DC}"
                          icon: dc
                          eq: "10+%{#{ability}}+%{spell-proficiency-bonus}+%{spell-dc-misc}"
                        inputs:
                          - span: "10 +"
                          - field:
                            ref: "#{ability}"
                            label: "#{ability-name}"
                            underlay: "#{ability-name}"
                          - span: "+"
                          - field: "spell-proficiency"
                            label: "_{Proficiency}"
                            control: proficiency
                            value: trained
                          # - field: "spell-dc-misc"
                          #   label: "_{Misc}"
                          #   misc: true

              - g:
                contents:
                  - switch: "#{cantrips}"
                    case:
                      "1":
                        - p: "_{Start with one cantrip.}"
                      "2":
                        - p: "_{Start with two cantrips.}"
                  - table: "#{id}:spellcasting"
                    collapse: true
                    rows:
                      - contents:
                          - g:
                          - g:
                            colspan: 3
                            contents:
                              - field: "archetype-#{id}-spellcasting-basic"
                                frame: right
                                control: checkbox
                                style: progress
                                label: "_{Basic}"
                          - g:
                            colspan: 3
                            vr: true
                            contents:
                              - field: "archetype-#{id}-spellcasting-expert"
                                frame: right
                                control: checkbox
                                style: progress
                                label: "_{Expert}"
                          - g:
                            colspan: 3
                            vr: true
                            contents:
                              - field: "archetype-#{id}-spellcasting-master"
                                frame: right
                                control: checkbox
                                style: progress
                                label: "_{Master}"
                      - contents:
                          - label: "_{Class\nLevel}"
                            rotate: true
                            width: tiny
                          - value: 4
                          - value: 6
                          - value: 8
                          - value: 12
                            vr: true
                          - value: 14
                          - value: 16
                          - value: 18
                            vr: true
                          - value: 20
                          - value: ""

                      - contents:
                          - hr:
                            light: true
                          - g:
                          - g:
                          - g:
                          - g:
                            vr: true
                          - g:
                          - g:
                          - g:
                            vr: true
                          - g:
                          - g:

                      - contents:
                          - label: "_{Spell\nRank}"
                            rotate: true
                            width: tiny
                          - value: "1"
                          - value: "2"
                          - value: "3"
                          - value: "4"
                            vr: true
                          - value: "5"
                          - value: "6"
                          - value: "7"
                            vr: true
                          - value: "8"
                          - value: ""

              - if: "#{breadth}"
                then:
                  - article: "#{id}:breadth"
                    title: "#{breadth}"
                    cat: "_{Feat} 8"
                    contents:
                      - selectable: "#{id}:breadth"
                        contents:
                          # - h5: "#{breadth}"
                          - if: "#{breadth-text}"
                            then:
                              - p: "#{breadth-text}"
                            else:
                              - if: "#{style}==prepared"
                                then:
                                  - p: "_{Gain an extra spell slot, and learn an extra spell, at each spell rank except your highest two.}"
                                else:
                                  - p: "_{Learn an extra spell at each spell rank except your highest two.}"

      - section: "_{Spells}"
        contents:
          - list:
            hr: true
            zebra: true
            contents:
              - paste: archetype-spellcasting-rank
                params:
                  rank: 0
                  style: "cantrip"
                  num: 3
                  max: 0
              - paste: archetype-spellcasting-rank
                params:
                  rank: 1
                  style: "#{style}"
                  num: 2
              - paste: archetype-spellcasting-rank
                params:
                  rank: 2
                  style: "#{style}"
                  num: 2
              - paste: archetype-spellcasting-rank
                params:
                  rank: 3
                  style: "#{style}"
                  num: 2
              - paste: archetype-spellcasting-rank
                params:
                  rank: 4
                  style: "#{style}"
                  num: 2
              - paste: archetype-spellcasting-rank
                params:
                  rank: 5
                  style: "#{style}"
                  num: 2
              - paste: archetype-spellcasting-rank
                params:
                  rank: 6
                  style: "#{style}"
                  num: 2
              - paste: archetype-spellcasting-rank
                params:
                  rank: 7
                  style: "#{style}"
                  num: 2
                  reduce: 1
              - paste: archetype-spellcasting-rank
                params:
                  rank: 8
                  style: "#{style}"
                  num: 2
                  reduce: 1


  - copy: archetype-bounded-spellcasting
    params:
      id: ""
      style: spontaneous
      ability: ""
      ability-name: ""
      breadth: ""
      spell-dcs-zone-id: ""
    contents:
      - section: "_{Spellcasting}"
        contents:
          - list:
            hr: true
            contents:
              # - item:
              
              - g:
                contents:
                  - zone: '#{spell-dcs-zone-id}'
                    contents:
                      - calc:
                        output:
                          field: "spell-attack"
                          legend: "_{Spell attack}"
                          icon: bonus
                        inputs:
                          - field:
                            ref: "#{ability}"
                            label: "#{ability-name}"
                            underlay: "#{ability-name}"
                          - span: "+"
                          - field: "spell-attack-proficiency"
                            label: "_{Proficiency}"
                            control: proficiency
                            value: trained
                          # - field: "spell-attack-misc"
                          #   label: "_{Misc}"
                          #   misc: true
                      - calc:
                        output:
                          field: "spell-dc"
                          legend: "_{Spell DC}"
                          icon: dc
                        inputs:
                          - span: "10 +"
                          - field:
                            ref: "#{ability}"
                            label: "#{ability-name}"
                            underlay: "#{ability-name}"
                          - span: "+"
                          - field: "spell-dc-proficiency"
                            label: "_{Proficiency}"
                            control: proficiency
                            value: trained
                          # - field: "spell-dc-misc"
                          #   label: "_{Misc}"
                          #   misc: true

              - g:
                contents:
                  - p: "_{Start with two cantrips.}"

                  - table: "#{id}:spells"
                    collapse: true
                    zebra: true
                    columns:
                      - ""
                      - "_{Level}"
                      - label: "_{Spells}"
                        colspan: 4
                      # - "_{Proficiency}"
                      - "_{Signature\nSpells}"
                    rows:
                      - level: 6
                        feat: "basic"
                        feat_name: "_{Basic}"
                        first: "_{1st}"
                        first_num: 1
                        second: "_{2nd}"
                        second_num: 1
                        proficiency: trained
                        signature: 1
                      - level: 10
                        first: "_{2nd}"
                        first_num: 1
                        second: "_{3rd}"
                        second_num: 1
                      - level: 12
                        feat: expert
                        feat_name: "_{Expert}"
                        first: "_{2nd}"
                        first_num: 2
                        second: "_{3rd}"
                        second_num: 1
                        proficiency: expert
                        signature: 2
                      - level: 14
                        first: "_{4th}"
                        first_num: 2
                        second: "_{5th}"
                        second_num: 1
                      - level: 16
                        first: "_{5th}"
                        first_num: 2
                        second: "_{6th}"
                        second_num: 1
                      - level: 18
                        feat: master
                        feat_name: "_{Master}"
                        first: "_{5th}"
                        first_num: 2
                        second: "_{6th}"
                        second_num: 2
                        proficiency: master
                      - level: 20
                        first: "_{6th}"
                        first_num: 2
                        second: "_{7th}"
                        second_num: 2

                    template:
                      - g:
                        contents:
                          - if: "#{feat}!="
                            then:
                              - field: "archetype-#{id}-spellcasting-#{feat}"
                                frame: right
                                control: checkbox
                                style: progress
                                label: "#{feat_name}"
                      - value: "#{level}"
                      - span: "#{first}"
                      - field: "#{id}-spells-lvl-6-#{first}"
                        control: checkgrid
                        max: "#{first_num}"
                        depth: auto
                        frame: none
                      - span: "#{second}"
                      - field: "#{id}-spells-lvl-6-#{second}"
                        control: checkgrid
                        max: "#{second_num}"
                        depth: auto
                        frame: none
                      # - g:
                      #   contents:
                      #     - if: "#{proficiency}!="
                      #       then:
                      #         - icon: "proficiency-#{proficiency}"
                      - g:
                        contents:
                          - if: "#{signature}!="
                            then:
                              - value: "#{signature}"

          - section: "_{Spells}"
            contents:
              - list:
                hr: true
                zebra: true
                contents:
                  - paste: archetype-spellcasting-rank
                    params:
                      rank: 0
                      style: "cantrip"
                      num: 2
                      max: 0
                  - repeat: 2
                    contents:
                      - layout: indent-l
                        contents:
                          - g:
                            contents:
                              - field: "archetype/spells-#{i}-rank"
                                label: "_{Spell\nRank}"
                                merge-bottom: true
                                width: small
                                border: full
                          - g:
                            contents:
                              - field: "archetype/spells-#{i}"
                                width: stretch
                                repeat: 3
                                frame: none
                                merge-bottom: true

  - copy: archetype-basic-alchemy
    contents:
      - section: "_{Alchemy}"
        contents:
          - list:
            hr: true
            contents:
              - zone: '@archetype-basic-alchemy/before'

              - g:
                contents:
                  - row:
                    contents:
                      - calc:
                        output:
                          field: archetype-infused-reagents-per-day
                          legend: "_{Infused Reagents\nPer Day}"
                          width: large
                        inputs:
                          - field:
                            ref: level
                            label: "_{Level}"

                      - spacer:
                      - field: archetype-infused-reagents-today
                        label: "_{Today}"
                        temp: true
                        border: full
                        width: huge

                  - zone: '@archetype-basic-alchemy/reagents-per-day'

                  # - paste: class-dc
                  #   params:
                  #     id: alchemist-class-dc
                  #     legend: "_{Alchemist\nClass DC}"

                  - row:
                    contents:
                      - calc:
                        output:
                          field: archetype-attack-#{i}-bonus
                          legend: "_{Throw Bomb}"
                          width: large
                          attack: true
                          icon: bonus
                        inputs:
                          - field:
                            ref: DEX
                            label: "_{DEX}"
                            underlay: "_{DEX}"
                          - span: "+"
                          - field: archetype-attack-#{i}-proficiency
                            control: proficiency
                            label: "_{Proficiency}"
                      - spacer:
                      - field: "archetype-attack-#{i}-splash"
                        legend: "_{Splash}"
                        # border: full
                        control: value
                        value: "_{5ft}"
                  - p: "_{Splash weapons don't add strength bonus to damage.}"
                    optional: true

              - g:
                contents:
                  - field: archetype-basic-alchemy-formulas"
                    label: "_{Formulas}"
                    repeat: 4
                    width: stretch
                    merge-bottom: true

            
      - section: "_{Advanced Alchemy}"
        flex: tiny
        contents:
          - row:
            contents:
              - g:
                contents:
                  - p: "_{Prepare alchemical items each day.}"
                    optional: true
                  - spacer:
                  - h5: "_{Today's Items}"
              - spacer:
              - level-marker:
                level: 1
                marker: "_{Infused\nReagents}"
              - span: "&rarr;"
              - level-marker:
                level: 2
                marker: "_{Alchemical\nItems}"

          - hr:
            blk: false

          - list:
            zebra: true
            merge-bottom: true
            avoid-shade: true
            contents:
              - repeat: 5
                reduce: 3
                contents:
                  - row:
                    contents:
                      - field: alchemist-advanced-alchemy-infusion-#{i}
                        width: stretch
                        frame: none
                      - field: alchemist-advanced-alchemy-infusion-#{i}-count
                        frame: none
                        underlay: "#"
                      - field: alchemist-advanced-alchemy-infusion-#{i}-used
                        frame: none
                        control: checkgrid
                        depth: 2
                        max: 8
                        
          - hr:
            blk: false

          - p: "_{Considered level 1 for advanced alchemy.}"

      - section: "_{Quick Alchemy}"
        contents:
          - list:
            hr: true
            contents:
              - action:
                contents:
                  - row:
                    contents:
                      - level-marker:
                        level: 1
                        marker: "_{Infused\nReagents}"
                      - span: "&rarr;"
                      - level-marker:
                        level: 1
                        marker: "_{Alchemical\nItems}"
                  - p: "_{Swiftly mix up an infusion using a formula in your book, without spending the normal cost.}"
                  - p: "_{These last only one round.}"
                    optional: true
